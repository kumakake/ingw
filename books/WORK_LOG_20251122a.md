# 作業ログ 2025-11-22 (追加作業)

## 概要
Token有効期限の画面表示機能を追加

---

## 1. Token有効期限表示機能

### 変更内容

#### `src/controllers/authController.js`
コールバックデータに `tokenExpiresAt` を追加:

```javascript
const resultData = results.map(r => ({
  accessToken: r.accessToken,
  tokenExpiresAt: r.tokenExpiresAt,  // 追加
  facebookPageName: r.facebookPageName,
  instagramUsername: r.instagramUsername,
  instagramUserId: r.instagramUserId,
  facebookPageId: r.facebookPageId,
}));
```

#### `public/index.html`

##### 1. 日付フォーマット関数を追加
```javascript
function formatExpiryDate(dateString) {
    if (!dateString) return 'N/A';
    const date = new Date(dateString);
    const now = new Date();
    const diffDays = Math.ceil((date - now) / (1000 * 60 * 60 * 24));

    const formatted = date.toLocaleDateString('ja-JP', {
        year: 'numeric',
        month: '2-digit',
        day: '2-digit',
        hour: '2-digit',
        minute: '2-digit'
    });

    if (diffDays <= 0) {
        return `⚠️ ${formatted} (期限切れ)`;
    } else if (diffDays <= 30) {
        return `⚠️ ${formatted} (残り${diffDays}日)`;
    } else {
        return `✅ ${formatted} (残り${diffDays}日)`;
    }
}
```

##### 2. 結果カードに有効期限表示を追加
Access Token の下に Token有効期限 行を追加:
```html
<div class="result-item">
    <span class="result-label">Token有効期限:</span>
    <span class="result-value" style="color: #e67e22; font-weight: 600;">
        ${formatExpiryDate(account.tokenExpiresAt)}
    </span>
</div>
```

---

## 2. 表示形式

| 状態 | 表示例 |
|------|--------|
| 30日以上 | ✅ 2026/01/21 16:22 (残り60日) |
| 30日以内 | ⚠️ 2026/01/21 16:22 (残り25日) |
| 期限切れ | ⚠️ 2026/01/21 16:22 (期限切れ) |

---

## 3. 画面表示順序

1. Access Token
2. **Token有効期限** ← 新規追加
3. Instagram User ID
4. Instagram ユーザー名
5. Facebook Page ID
6. Facebook ページ名

---

## 4. 関連ファイル一覧

| ファイル | 変更内容 |
|---------|---------|
| `src/controllers/authController.js` | `tokenExpiresAt` をレスポンスに追加 |
| `public/index.html` | `formatExpiryDate` 関数追加、有効期限表示追加 |
